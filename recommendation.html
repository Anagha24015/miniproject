<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Recommendation</title>
  <style>
    body {
        margin: 0;
        font-family: 'Segoe UI', sans-serif;
        /*background-image: url('https://png.pngtree.com/png-vector/20220610/ourmid/pngtree-world-map-silhouette-vector-australia-png-image_4955918.png');*/
        background-repeat: no-repeat;
        background-color: #f7f7f7;
        background-size: 100% auto;
    
    }

    /* Banner section only */
    .top-banner {
        height: 200px;
        background-image: url('https://poonawallafincorp.com/documents/213163/213167/blog_banner-banner-image-checklist-of-things-to-carry-while-travelling-for-a-seamless-experience.jpg');
        background-repeat: no-repeat;
        background-position: center;
        background-size: 100% auto;
        display: flex;
        margin-top: 0px;
        flex-direction: column;
        justify-content: center;
        color: rgb(250, 246, 246);
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    .logo {
        font-size: 90px;
        font-style: italic;
        margin-left: 40px;
        margin-top:7px;
    }

    .nav {
        display:flex;
        gap: 20px;
        font-weight: bold;
        font-size: 20px;
        margin-top: 30px;
        margin-left: auto;
        margin-right: 100px;
        color:white;
    }

    .nav :hover {
        cursor: pointer;
    }

    h1 {
      color: #4a4a4a;
      margin-left:544px;
    }
    .packing-list {
      background: white;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      margin-left:450px;
      margin-bottom: 40px;
    }
    ul {
      line-height: 1.8;
    }
    .buttons {
      margin-top: 20px;
      margin-left:572px;
      margin-bottom:40px;
    }
    .buttons button {
      margin-right: 10px;
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .download-btn {
      background-color: #28a745;
      color: white;
    }
    .save-btn {
      background-color: #007bff;
      color: white;
    }
    .load-btn {
      background-color: #ffc107;
      color: black;
    }

    /*.share-btn {
      background-color: #17a2b8;
      color: white;
    }*/


  /*profile icon*/

.profile-dropdown {
    position: relative;
    display: inline-block;
}

.profile-icon {
    font-size: 30px;
    cursor: pointer;
    color: white;
    margin-left:1430px;
    height:60px;
    width:60px;
    margin-top:-30px;
}

.dropdown-menu {
    display: none;
    position: absolute;
    right: 0;
    top: 40px;
    background-color: white;
    min-width: 150px;
    box-shadow: 0px 4px 6px rgba(0,0,0,0.2);
    z-index: 1;
    border-radius: 8px;
    overflow: hidden;
    color: #333;
    padding: 13px 17px;
    text-decoration: none;
}



.dropdown-menu :hover {
    background-color: #f0f0f0;
    cursor: pointer;
}

footer {
            text-align: center;
            padding: 20px;
            background-color: #f1f1f1;
            margin-top: 40px;
            font-size: 14px;
            color: #777;
}

#savedListSelect {
  width: 100%;
  padding: 8px;
  margin-top: 8px;
  margin-bottom: 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

#viewSavedListBtn {
  padding: 8px 18px;
  border-radius: 6px;
  border: none;
  background: #007bff;
  color: white;
  font-size: 1rem;
  cursor: pointer;
  margin-top: 4px;
}

  </style>
</head>
<body>
    <div class="top-banner">
        <div class="logo">BONVOYAGE</div>
        <div class="nav">
          <span onclick="goHome()">Home</span>
          <span onclick="faq()">FAQ</span>
          <span onclick="blogs()">Blogs</span>
          <span onclick="contact()">Contact</span>
        </div>
    </div>

    <div class="profile-dropdown">
        <img src="https://icon-library.com/images/contact-icon-png/contact-icon-png-5.jpg" class="profile-icon" onclick="toggleDropdown()" alt="Profile">

        <div class="dropdown-menu" id="dropdownMenu">
          <span onclick="editprofile()"> Edit Profile </span><br>
          <span onclick="logout()"> Logout </span>
        </div>
    </div>

  <h1>Your AI-Powered Packing List</h1>
  <div class="packing-list" id="result">
    <!-- Packing list will be shown here -->
  </div>

  <div class="buttons">
    <button class="download-btn" onclick="downloadList()">â¬‡ Download</button>
    <button class="save-btn" onclick="saveList()">ðŸ’¾ Save</button>
    <button class="load-btn" onclick="loadList()">ðŸ”„ Load Saved</button>
    <!--<button class="share-btn" onclick="shareList()">ðŸ“¤ Share</button>-->
  </div>

  <script>
    // Protect this page: if not logged in, redirect to login/start page
    if (!localStorage.getItem('firebaseIdToken')) {
      window.location.replace('myproject design 2.html');
    }

    // On page load, get trip details and call AI recommendation endpoint
    window.onload = function() {
      const tripDetails = JSON.parse(localStorage.getItem('tripDetails'));
      if (!tripDetails) {
        alert('No trip details found. Please start from the previous page.');
        window.location.href = 'details2.html';
        return;
      }
      const idToken = localStorage.getItem('firebaseIdToken');
      if (!idToken) {
        alert('You are not logged in. Please log in again.');
        window.location.href = 'myproject design 2.html';
        return;
      }
      fetch('http://localhost:5000/api/packing-list/recommend', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + idToken
        },
        body: JSON.stringify(tripDetails)
      })
      .then(response => response.json())
      .then(data => {
        window.packingItems = data.items;
        displayPackingList(data.items);
      })
      .catch(err => {
        alert('Failed to get recommendation: ' + err.message);
      });
    };

    function displayPackingList(items) {
      const resultDiv = document.getElementById('result');
      const listHTML = `
        <h2>Recommended Items:</h2>
        <ul>${items.map(item => `<li>${item}</li>`).join('')}</ul>
        <textarea id="editList" style="width:100%;height:100px;">${items.join('\n')}</textarea>
        <p>Edit the list above if needed before saving.</p>
      `;
      resultDiv.innerHTML = listHTML;
    }

    function downloadList() {
      const editListElem = document.getElementById('editList');
      let items = [];
      if (editListElem) {
        items = editListElem.value.split('\n').map(item => item.trim()).filter(Boolean);
      } else if (window.packingItems) {
        items = window.packingItems;
      }
      const blob = new Blob([items.join("\n")], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "packing_list.txt";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function saveList() {
      const idToken = localStorage.getItem('firebaseIdToken');
      const tripDetails = JSON.parse(localStorage.getItem('tripDetails'));
      const editedList = document.getElementById('editList').value.split('\n').map(item => item.trim()).filter(Boolean);
      if (!idToken || !tripDetails) {
        alert('Missing authentication or trip details.');
        return;
      }
      fetch('http://localhost:5000/api/packing-list', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + idToken
        },
        body: JSON.stringify({
          tripDetails: tripDetails,
          items: editedList
        })
      })
      .then(response => response.json())
      .then(data => {
        alert('Packing list saved to your account!');
      })
      .catch(err => {
        alert('Failed to save packing list: ' + err.message);
      });
    }

    function loadList() {
      const idToken = localStorage.getItem('firebaseIdToken');
      if (!idToken) {
        alert('You are not logged in. Please log in again.');
        window.location.href = 'myproject design 2.html';
        return;
      }
      fetch('http://localhost:5000/api/packing-list', {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + idToken
        }
      })
      .then(response => response.json())
      .then(lists => {
        if (!Array.isArray(lists) || lists.length === 0) {
          alert('No saved lists found.');
          return;
        }
        // Show a selection dialog for all saved lists
        let listOptions = lists.map((list, idx) => {
          const date = new Date(list.createdAt).toLocaleString();
          const trip = list.tripDetails || {};
          return `<option value="${idx}">Trip: ${trip.climate || ''}, ${trip.travelType || ''}, ${trip.accommodation || ''}, Destination: ${trip.destination || ''}, Companions: ${(trip.companions || []).join(', ')} [${date}]</option>`;
        }).join('');
        const selectHTML = `<label for="savedListSelect">Select a saved packing list:</label><select id="savedListSelect">${listOptions}</select><button id="viewSavedListBtn">View</button>`;
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = selectHTML;
        document.getElementById('viewSavedListBtn').onclick = function() {
          const idx = document.getElementById('savedListSelect').value;
          const items = lists[idx].items;
          displayPackingList(items);
        };
      })
      .catch(err => {
        alert('Failed to load saved lists: ' + err.message);
      });
    }

    /*profile icon*/
            
    function toggleDropdown() {
    const dropdown = document.getElementById("dropdownMenu");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    }

  
    window.onclick = function(event) {
    if (!event.target.matches('.profile-icon')) {
        const dropdown = document.getElementById("dropdownMenu");
        if (dropdown && dropdown.style.display === "block") {
            dropdown.style.display = "none";
        }
        }
    }
    
    function goHome() {
        window.location.href = 'Home page.html';  
    }

    function faq(){
        window.location.href = 'FAQ.html';
    }

    function blogs(){
        window.location.href = 'blogs.html';
    }

    function contact(){
        window.location.href = 'Contact.html';
    }

    function editprofile(){
        window.location.href = 'edit profile2.html';
    }
            
    function logout() {
        // Clear all authentication/session data
        localStorage.removeItem('firebaseIdToken');
        localStorage.removeItem('userProfile');
        localStorage.removeItem('tripDetails');
        localStorage.removeItem('destination');
        // Redirect and replace history
        window.location.replace('myproject design 2.html');
    }


  </script>

<footer>
  Â© 2025 Bonvoyage- Travel Packing Assistant. All rights reserved.
</footer>

</body>
</html>
